<!doctype html>
<html class="h-100" lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  
  <link rel="stylesheet" href="styles.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Days+One&family=Jua&family=Press+Start+2P&family=Qahiri&family=Rationale&display=swap" rel="stylesheet"> 

  <title>MineSweeter</title>
</head>
<body id='body' class="d-flex h-100 text-center text-white bg-dark">
  <div class="container-fluid w-100 h-100">
    <div class="row h-100 d-flex">
      
      <div class="col-xl-2 col-lg-3 ad-skyscrapper me-auto d-none d-lg-flex
                  align-self-center align-items-center justify-content-center ">
        Ad skyscrapper
      </div>

      <div class="col-xl-8 col-lg-6 d-flex vh-100 p-3 mx-auto flex-column">

        <header class="mb-auto">
          <a id='mineHeader' href="/" 
              class="my-3 mx-auto d-inline-block text-white text-decoration-none">
            <span class="display-4 align-middle" 
                  style="font-family: 'Rationale'">
              MineSweeter
            </span>
          </a>

          <p>
            Clear this minefield to help clear
            <u data-bs-toggle="tooltip" data-bs-placement="top"
                title="Yes, real world minefields">real</u>
            minefields! 
            <a data-bs-toggle="modal" href="#aboutModal">How so?</a>
          </p>

          <a data-bs-toggle="modal" href="#howToPlayModal">How to play</a>

          <div class="ad-mobile-banner d-flex d-sm-none
                      align-items-center justify-content-center">
            Ad mobile banner
          </div>
          <div class="ad-full-banner d-none d-sm-flex d-md-none
                      align-items-center justify-content-center">
            Ad full banner
          </div>
          <div class="ad-leaderboard d-none d-md-flex d-lg-none
                      align-items-center justify-content-center">
            Ad leaderboard
          </div>
        </header>

        <main class="d-flex flex-column justify-content-center">
          <div id="playAgainButtonSlot" 
               class="d-flex flex-row justify-content-center m-3 play-again-slot">
            &nbsp;
          </div>

          <table id="minefield" class="number-text mt-3 mx-auto d-flex"
                 oncontextmenu="return false;">
          </table>

          <p id='mineCounter' class="m-3 d-inline-block" 
              data-bs-toggle="tooltip" data-bs-placement="top"
              title="Number of remaining mines">
          </p>
          <br>
          
          <div data-bs-toggle="tooltip" data-bs-placement="top"
               title="Settings" class="d-inline-block">
            <a id='gear' data-bs-toggle="modal" 
                href="#settingsModal" class="my-3">
            </a>
          </div>
        </main>
        
        <footer class="mt-auto">
          <a id='gear' data-bs-toggle="modal" href="#settingsModal"></a>
          
          <a class='fs-7' data-bs-toggle="modal" href="#codeModal">
            How the code works
          </a>
          
          <div class="ad-mobile-banner d-flex d-sm-none
                      align-items-center justify-content-center">
            Ad mobile banner
          </div>
          <div class="ad-full-banner d-none d-sm-flex d-md-none
                      align-items-center justify-content-center">
            Ad full banner
          </div>
          <div class="ad-leaderboard d-none d-md-flex d-lg-none
                      align-items-center justify-content-center">
            Ad leaderboard
          </div>
        </footer>

      </div>
      
      <div class="col-xl-2 col-lg-3 ad-skyscrapper ms-auto d-none d-lg-flex
                  align-self-center align-items-center justify-content-center">
        Ad skyscrapper
      </div>

    </div>
  </div>

      
  <div id="settingsModal" class="modal fade" tabindex="-1" 
       aria-labelledby="settingsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark">
        <div class="modal-header">
          <h5 class="modal-title" id="settingsModalLabel">Settings</h5>
          <button type="button" class="btn-close bg-light" 
                  data-bs-dismiss="modal" aria-label="Close">
          </button>
        </div>

        <div class="modal-body">
          
          <div class="dropdown m-3">
            <button class="btn btn-secondary btn-sm dropdown-toggle"
                    type="button" id="sizeDropdown" data-bs-toggle="dropdown"
                    aria-expanded="false">
            </button>
            <ul class="dropdown-menu" aria-labelledby="sizeDropdown">
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setSize(9, 9); return false;">
                  9 x 9
                </a>
              </li>
              <li class="d-md-none">
                <a class="dropdown-item" href="#" 
                       onclick="setSize(16, 9); return false;">
                  16 x 9
                </a>
              </li>
              <li class="d-none d-md-flex">
                <a class="dropdown-item" href="#" 
                       onclick="setSize(9, 16); return false;">
                  9 x 16
                </a>
              </li>
              <li class="d-none d-md-flex">
                <a class="dropdown-item" href="#" 
                       onclick="setSize(16, 16); return false;">
                  16 x 16
                </a>
              </li>
              <li class="d-none d-xxl-flex">
                <a class="dropdown-item" href="#"
                    onclick="setSize(16, 30); return false;">
                  16 x 30
                </a>
              </li>
              <li class="d-none d-md-flex d-xxl-none">
                <a class="dropdown-item" href="#"
                    onclick="setSize(30, 16); return false;">
                  30 x 16
                </a>
              </li>
              <li class="d-none d-xxl-flex">
                <a class="dropdown-item" href="#"
                    onclick="setSize(30, 30); return false;">
                  30 x 30
                </a>
              </li>
            </ul>
          </div>

          <div class="dropdown m-3">
            <button class="btn btn-secondary dropdown-toggle btn-sm"
                    type="button" id="fillRatioDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
            </button>
            <ul class="dropdown-menu" aria-labelledby="fillRatioDropdown">
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setFillRatio(0.1); return false;">
                  10%
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setFillRatio(0.2); return false;">
                  20%
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setFillRatio(0.3); return false;">
                  30%
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setFillRatio(0.4); return false;">
                  40%
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setFillRatio(0.5); return false;">
                  50%
                </a>
              </li>
            </ul>
          </div>

          <div class="dropdown m-3">
            <button class="btn btn-secondary dropdown-toggle btn-sm"
                    type="button" id="sweepDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
            </button>
            <ul class="dropdown-menu" aria-labelledby="sweepDropdown">
              <!-- makeshift implementation -->
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setSweepAction('onclick', 'oncontextmenu'); return false">
                  Left click
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setSweepAction('oncontextmenu', 'onclick'); return false">
                  Right click
                </a>
              </li>
            </ul>
          </div>
          
          <div class="dropdown m-3">
            <button class="btn btn-secondary dropdown-toggle btn-sm"
                    type="button" id="fontDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
              Numbers font
            </button>
            <ul class="dropdown-menu" aria-labelledby="fontDropdown">
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setFont('Rationale'); return false;">
                  <span style="font-family: 'Rationale';">
                    123456789
                  </span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setFont('Jua'); return false;">
                  <span style="font-family: 'Jua';">
                    123456789
                  </span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setFont('Days One'); return false;">
                  <span style="font-family: 'Days One';">
                    123456789
                  </span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#"
                    onclick="setFont('Press Start 2P'); return false;">
                  <span style="font-family: 'Press Start 2P';">
                    123456789
                  </span>
                </a>
              </li>
            </ul>
          </div>

          <!-- <div class="dropdown m-3">
            <button class="btn btn-secondary dropdown-toggle btn-sm"
                    type="button" id="dropdownMenuButton1"
                    data-bs-toggle="dropdown" aria-expanded="false">
              Dropdown button
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
              <li>
                <a class="dropdown-item" href="#">
                  Action
                </a>
              </li>
            </ul>
          </div> -->
      
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" 
                  data-bs-dismiss="modal"
                  onclick="cancelChanges(); return false;">
            Cancel
          </button>
          <button type="button" class="btn btn-primary"
                  onclick="applyChanges(); return false;">
            Save changes
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="aboutModal" class="modal fade" tabindex="-1" 
       aria-labelledby="aboutModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark">
        <div class="modal-header">
          <h5 class="modal-title" id="aboutModalLabel">About us</h5>
          <button type="button" class="btn-close bg-light" 
                  data-bs-dismiss="modal" aria-label="Close">
          </button>
        </div>
        <div class="modal-body">
          <p>
            This is a website where you can play minesweeper whilst supporting a non-profit organisation which clears out minefields and explosives around the world: 
            The Halo Trust.
            This website's extra ad revenue is donated directly to them, so it's important to disable your adblocker and give your support!
            If you want to help more concretely, you can go make a donation on
            <a href="https://www.halotrust.org/">halotrust.org</a>.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div id="howToPlayModal" class="modal fade" tabindex="-1" 
       aria-labelledby="howToPlayModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark">
        <div class="modal-header">
          <h5 class="modal-title" id="howToPlayModalLabel">How to play</h5>
          <button type="button" class="btn-close bg-light" 
                  data-bs-dismiss="modal" aria-label="Close">
          </button>
        </div>
        <div class="modal-body">
          <p id="howToPlay">
            <a href="http://computronium.org/minesweeper/index.html">here</a>.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div id="codeModal" class="modal fade" tabindex="-1" 
       aria-labelledby="codeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content bg-dark">
        <div class="modal-header">
          <h5 class="modal-title" id="codeModalLabel">The code</h5>
          <button type="button" class="btn-close bg-light" 
              data-bs-dismiss="modal" aria-label="Close">
          </button>
        </div>
        <div class="modal-body text-start lh-1">
          <pre><code class="code">
            <br><span class="text-primary">// Welcome to behind the scenes!</span>
            <br><span class="text-primary">// Here you can see how the core of the website (the game in it of itself) works.</span>
            <br><span class="text-primary">// If you want to see the whole project you can go on https://github.com/TheAxan/Minesweeper-website</span>
            <br>
            <br>
            <br><span class="text-primary">// First off, we need to generate the minefield data which is in the form of an array</span>
            <br>var minefield = null;
            <br>var mineCounter = Math.round(gridHeight * gridWidth * fillRatio);
            <br>function generateMinefieldArray() {
            <br>    <span class="text-primary">// we generate a two dimensional array with the set sizes</span>
            <br>    minefield = new Array(gridHeight)
            <br>        .fill(null)
            <br>        .map(
            <br>            () => Array(gridWidth).fill(0)
            <br>        );
            <br>    <span class="text-primary">// then we iteratively place new mines in it</span>
            <br>    for (let placed = 0; placed < mineCounter;) {
            <br>        let x = getRandomInt(0, gridWidth);
            <br>        let y = getRandomInt(0, gridHeight);
            <br>        <span class="text-primary">// of course, we don't add mines on other mines</span>
            <br>        if (minefield[y][x] < 9) {
            <br>            minefield[y][x] = 9;
            <br>            <span class="text-primary">// here we use the neighborsArray function which we will declare soon</span>
            <br>            for (let [i, j] of neighborsArray(x, y)) {
            <br>                <span class="text-primary">// same for raiseMinecount</span>
            <br>                raiseMinecount(i, j);
            <br>            };
            <br>            placed++;
            <br>        };
            <br>    };
            <br>};
            <br>
            <br><span class="text-primary">// since we're only declaring functions, the order isn't important yet</span>
            <br><span class="text-primary">// so, in generateMinefieldArray we can use neighborsArray</span>
            <br>function neighborsArray(x, y) {
            <br>    let output = new Array;
            <br>    for (let [i, j] of [
            <br>        <span class="text-primary">// we iterate over the cells around the center one</span>
            <br>        [-1, -1], [-1, 0], [-1, 1], [0, -1], [0, 1], [1, -1], [1, 0], [1, 1]
            <br>    ]) {
            <br>        <span class="text-primary">// and if they're in the grid</span>
            <br>        if (-1 < y+j && y+j < gridHeight && -1 < x+i && x+i < gridWidth) {
            <br>            <span class="text-primary">// we add their coordinates to the output</span>
            <br>            output.push([x+i, y+j]);
            <br>        };
            <br>    };
            <br>    return output;
            <br>};
            <br><span class="text-primary">// and raiseMinecount, which, well, raises the count of mines around the cell</span>
            <br>function raiseMinecount(x, y) {
            <br>    if (minefield[y][x] < 9) {
            <br>        minefield[y][x]++;
            <br>    };
            <br>};
            <br>
            <br><span class="text-primary">// Then we need to keep track of which cells have been explored</span>
            <br>var explored = new Set();
            <br><span class="text-primary">// with this new set, we can setup a win condition!</span>
            <br>function checkForWin() {
            <br>    if (explored.size + mineCounter == gridHeight * gridWidth) {
            <br>        document.getElementById('mineCounter').innerHTML = 'Well played!';
            <br>        generatePlayAgainButton();
            <br>    };
            <br>};
            <br>
            <br><span class="text-primary">// Next up is interacting with the playboard with the sweep function</span>
            <br><span class="text-primary">// since the first sweep must be a 0 the first sweep creates the minefield</span>
            <br><span class="text-primary">// and then it rebinds itself to the real function</span>
            <br>function sweep(x, y) {
            <br>    regenerateMinefield(x, y);
            <br>    sweep = gameStartedSweep;
            <br>    sweep(x, y);
            <br>};
            <br><span class="text-primary">// regenerateMinefield recursively generates minefields until there is one with 0 as the first sweep</span>
            <br>function regenerateMinefield(x, y) {
            <br>    if (minefield[y][x] !== 0) {
            <br>        generateMinefieldArray();
            <br>        regenerateMinefield(x, y);
            <br>    };
            <br>};
            <br><span class="text-primary">// here we have the real sweep fonction</span>
            <br><span class="text-primary">// quite beefy isn't it?</span>
            <br>function gameStartedSweep(x, y, recursive=false) {
            <br>    <span class="text-primary">// there are two contexts in which the sweep fonction is called</span>
            <br>    <span class="text-primary">// the first one is when you're sweeping an unexplored cell</span>
            <br>    if (!explored.has(String([x, y]))) {
            <br>        let cell = document.getElementById(`cell-${x}-${y}`);
            <br>        let cellValue = minefield[y][x];
            <br>        
            <br>        <span class="text-primary">// when the cell has no mine around it</span>
            <br>        if (cellValue === 0) {
            <br>            cell.innerHTML = '';
            <br>            explored.add(String([x, y]));
            <br>            <span class="text-primary">// we automatically explore the cells around, this is recursion!</span>
            <br>            for (let [i, j] of neighborsArray(x, y)) {
            <br>                sweep(i, j, true);
            <br>            };
            <br>        
            <br>        <span class="text-primary">// when we hit a mine </span>
            <br>        } else if (cellValue === 9) {
            <br>            <span class="text-primary">// we need to display it</span>
            <br>            cell.innerHTML = mineSVG('#FFFFFF');
            <br>            <span class="text-primary">// stop interactions</span>
            <br>            sweep = flag = gameOverAction;
            <br>            <span class="text-primary">// and prompt the play to retry</span>
            <br>            generatePlayAgainButton();
            <br>
            <br>        <span class="text-primary">// if there's mines AROUND the cell</span>
            <br>        } else {
            <br>            <span class="text-primary">// we identify how many there are</span>
            <br>            cell.innerHTML = cellValue;
            <br>            <span class="text-primary">// setup the chaining interaction</span>
            <br>            cell.setAttribute(
            <br>                sweepAction, 
            <br>                `sweep(${x}, ${y});
            <br>                event.stopPropagation();
            <br>                return false;`
            <br>            )
            <br>            <span class="text-primary">// and add it to the explored set</span>
            <br>            explored.add(String([x, y]));
            <br>        };
            <br>        <span class="text-primary">// a sweep can be the last one, so we check for the win condition</span>
            <br>        checkForWin();
            <br>    <span class="text-primary">// the second one is when you're sweeping an explored cell</span>
            <br>    <span class="text-primary">// however the sweep recursion can also sweep these cells</span>
            <br>    <span class="text-primary">// which is why we prevent it with the recursive condition</span>
            <br>    } else if (!recursive) {
            <br>        <span class="text-primary">// Sometimes the explored cell has flag</span>
            <br>        if (document.getElementById(`button-${x}-${y}`) != null) {
            <br>            <span class="text-primary">// so we call the flag function to remove the flag</span>
            <br>            flag(x, y);
            <br>        <span class="text-primary">// Otherwise, it's for chain sweeping</span>
            <br>        } else {
            <br>            for (let [i, j] of neighborsArray(x, y)) {
            <br>                sweep(i, j, true);
            <br>            };
            <br>        };
            <br>    };
            <br>};
            <br>
            <br><span class="text-primary">// if we rebind sweep and flag to gameOverAction they can't do anything</span>
            <br>function gameOverAction() {
            <br>    return;
            <br>};
            <br>
            <br><span class="text-primary">// of course we also need to declare the flag fonction</span>
            <br>function flag(x, y) {
            <br>    let button = document.getElementById(`button-${x}-${y}`);
            <br>    <span class="text-primary">// if the button doesn't have a flag</span>
            <br>    if (button.innerHTML == '') {
            <br>        <span class="text-primary">// we add one</span>
            <br>        button.innerHTML = flagSVG('#FFFFFF');
            <br>        <span class="text-primary">// update the counter</span>
            <br>        mineCounter--;
            <br>        generateMineCounter();
            <br>        <span class="text-primary">// and add it to the explored set</span>
            <br>        explored.add(String([x, y]));
            <br>    <span class="text-primary">// if it does have flag</span>
            <br>    } else {
            <br>        <span class="text-primary">// we remove it</span>
            <br>        button.innerHTML = '';
            <br>        <span class="text-primary">//update the counter</span>
            <br>        mineCounter++;
            <br>        generateMineCounter();
            <br>        <span class="text-primary">// and remove it from the explored set</span>
            <br>        explored.delete(String([x, y]));
            <br>    };
            <br>    <span class="text-primary">// a flag can be the last one, so we check for the win condition</span>
            <br>    checkForWin();
            <br>};
            <br>
            <br>
            <br><span class="text-primary">// and that's it for the programation logic of minesweeper!</span>
            <br><span class="text-primary">// However, there's a lot more going on to make it into a website</span>
            <br><span class="text-primary">// the nitty gritty implementation details aren't explained here,</span>
            <br><span class="text-primary">// but once again, you can go peek at them on https://github.com/TheAxan/Minesweeper-website</span>
          </code></pre>
        </div>
      </div>
    </div>
  </div>
    

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="myScript.js"></script>
</body>
</html>
